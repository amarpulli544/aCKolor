angular.module("aCKolor",[]).factory("CKolorFactory",function(){var o={alpha:100,ckoloring:!1,defaultColor:"#FFFFFF",display:"hex",inputHsl:{h:null,s:null,l:null},hex:null,hsl:{h:null,s:null,l:null},hues:[75,85,95,105,115,125,135,145,155,165,175,185,195,205,215,225,235,245,255,265,275,285,295,305,315,325,335,345,355,5,15,25,35,45,55,65],model:null,modelId:null,originalFormat:null,previousColors:[],rgb:{r:null,g:null,b:null},circleWidth:0,init:function(l){o.alpha=100,o.defaultColor=l.defaultColor?o.validHex(l.defaultColor):"#FFFFFF",o.model=l.model,o.modelId=l.modelId;var r=angular.fromJson(localStorage.aCKolorPreviousColors);r&&(o.previousColors=r);var e=o.convertTo();e&&(o.hsl.h=o.inputHsl.h=e.h,o.hsl.s=o.inputHsl.s=e.s,o.hsl.l=o.inputHsl.l=e.l,o.rgb=o.hslToRgb(e),o.hex=o.rgbToHex(o.rgb),o.display=o.originalFormat)},save:function(){if(100===o.alpha)switch(o.originalFormat){case"hex":o.model=o.hex;break;case"hsl":o.model="hsl("+o.hsl.h+","+o.hsl.s+"%,"+o.hsl.l+"%)";break;case"rgb":o.model="rgb("+o.rgb.r+","+o.rgb.g+","+o.rgb.b+")"}else"hsl"===o.originalFormat?o.model="hsla("+o.hsl.h+","+o.hsl.s+"%,"+o.hsl.l+"%,"+o.alpha/100+")":o.model="rgba("+o.rgb.r+","+o.rgb.g+","+o.rgb.b+","+o.alpha/100+")";-1===o.previousColors.indexOf(o.model)&&(o.previousColors.unshift(o.model),o.previousColors.length>20&&(o.previousColors.length=20),localStorage.aCKolorPreviousColors=angular.toJson(o.previousColors))},previousColorClick:function(l){o.originalFormat;var r=o.convertTo(l);r&&(o.hsl.h=o.inputHsl.h=r.h,o.hsl.s=o.inputHsl.s=r.s,o.hsl.l=o.inputHsl.l=r.l,o.rgb=o.hslToRgb(r),o.hex=o.rgbToHex(o.rgb),o.display=o.originalFormat),o.updateHSL()},toggleCKoloring:function(){o.ckoloring=!1},updateColorDisplay:function(l){return o.display=l,o.display},updateHSL:function(){o.hex=o.rgbToHex(o.hslToRgb(o.hsl)),o.rgb=o.hslToRgb(o.hsl),o.inputHsl=o.hsl},updateRGB:function(){o.hex=o.rgbToHex(o.rgb),o.hsl=o.rgbToHsl(o.rgb)},updateHEX:function(){o.hex=o.validHex(o.hex);var l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(o.hex);o.hex&&7===o.hex.length&&l&&(o.rgb=o.hexToRgb(o.hex),o.hsl=o.rgbToHsl(o.rgb))},validHex:function(o){var l=o.split("");return"#"===l[0]&&l.shift(),3===l.length&&(l=l.concat(l)),o="#"+l.join("")},hueLightFromRadial:function(l,r){var e,t;l.changedTouches?(e=l.changedTouches[0].clientX,t=l.changedTouches[0].clientY):(e=l.pageX,t=l.pageY);var n=r.getBoundingClientRect(),a=n.width/2,s=e-(a+n.left),i=t-(a+n.top),c=Math.atan2(i,s)*(180/Math.PI);c<0&&(c+=360);var h=Math.abs(s),u=Math.abs(i),d=Math.round(100-100*Math.sqrt(h*h+u*u)/a);return o.hsl.l=d>-1?d<101?d:100:0,o.hsl.h=Math.round(c)>-1||Math.round(c)<360?Math.round(c):0,o.updateHSL(),o.radialXY(),{h:o.hsl.h,l:o.hsl.l}},radialXY:function(){var l=o.circleWidth/2,r=l*((100-o.hsl.l)/100),e=o.hsl.h;return{x:l+r*Math.cos(e*Math.PI/180),y:2*l-(l+-r*Math.sin(e*Math.PI/180))}},convertTo:function(l){var r;return(l=l||(o.model?o.model:"null")).indexOf("#")>-1?(l=o.validHex(l),r=o.hexToRgb(l),o.originalFormat="hex",o.rgbToHsl(r)):l.indexOf("hsla")>-1?(l=l.split("(")[1],l=l.substring(0,l.length-1),l=l.split(","),o.originalFormat="hsl",o.alpha=100*l[3],{h:parseInt(l[0]),s:parseInt(l[1]),l:parseInt(l[2])}):l.indexOf("hsl")>-1?(l=l.split("(")[1],l=l.substring(0,l.length-1),l=l.split(","),o.originalFormat="hsl",{h:parseInt(l[0]),s:parseInt(l[1]),l:parseInt(l[2])}):l.indexOf("rgba")>-1?(l=l.split("(")[1],l=l.substring(0,l.length-1),l=l.split(","),o.originalFormat="rgb",o.alpha=100*l[3],o.rgbToHsl({r:parseInt(l[0]),g:parseInt(l[1]),b:parseInt(l[2])})):l.indexOf("rgb")>-1?(l=l.split("(")[1],l=l.substring(0,l.length-1),l=l.split(","),o.originalFormat="rgb",o.rgbToHsl({r:parseInt(l[0]),g:parseInt(l[1]),b:parseInt(l[2])})):l.indexOf("transparent")>-1?(o.originalFormat="rgb",o.alpha=0,r=o.hexToRgb(o.defaultColor),o.rgbToHsl(r)):(o.originalFormat="rgb",r=o.hexToRgb(o.defaultColor),o.rgbToHsl(r))},hexToRgb:function(o){var l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(o);return l?{r:parseInt(l[1],16),g:parseInt(l[2],16),b:parseInt(l[3],16)}:null},rgbToHsl:function(l){var r,e,t=l.r/255,n=l.g/255,a=l.b/255,s=Math.max(t,n,a),i=Math.min(t,n,a),c=(s+i)/2;if(s==i)r=e=0;else{var h=s-i;switch(e=c>.5?h/(2-s-i):h/(s+i),s){case t:r=(n-a)/h+(n<a?6:0);break;case n:r=(a-t)/h+2;break;case a:r=(t-n)/h+4}r/=6}return(0===r||isNaN(r))&&(r=o.hsl.h),{h:Math.round(360*r*100)/100,s:Math.round(100*e*100)/100,l:Math.round(100*c*100)/100}},hslToRgb:function(o){var l,r,e,t,n,a,s=o.h,i=o.s,c=o.l;return isFinite(s)||(s=0),isFinite(i)||(i=0),isFinite(c)||(c=0),(s/=60)<0&&(s=6- -s%6),s%=6,i=Math.max(0,Math.min(1,i/100)),c=Math.max(0,Math.min(1,c/100)),n=(1-Math.abs(2*c-1))*i,a=n*(1-Math.abs(s%2-1)),s<1?(l=n,r=a,e=0):s<2?(l=a,r=n,e=0):s<3?(l=0,r=n,e=a):s<4?(l=0,r=a,e=n):s<5?(l=a,r=0,e=n):(l=n,r=0,e=a),t=c-n/2,l=Math.round(255*(l+t)),r=Math.round(255*(r+t)),e=Math.round(255*(e+t)),{r:l,g:r,b:e}},intToHex:function(o){var l=parseInt(o).toString(16);return l.length<2?"0"+l:l},rgbToHex:function(l){return"#"+o.intToHex(l.r)+o.intToHex(l.g)+o.intToHex(l.b)}};return o}),function(o){"use strict";o.directive("aCkolorHexInput",function(){return{restrict:"A",require:"ngModel",link:function(o,l,r,e){e.$parsers.push(function(o){var l=o.split("");return"#"===l[0]&&l.shift(),3===l.length&&(l=l.concat(l)),o="#"+l.join("")})}}})}(angular.module("aCKolor")),angular.module("aCKolor").directive("aCkolor",["$document","CKolorFactory","$compile","$timeout",function(o,l,r,e){return{restrict:"E",scope:{onChange:"=?",elementId:"=",inputId:"=",model:"=",name:"=",type:"=",defaultColor:"=",blur:"="},template:'<div class="c-ckolor__wrapper" id="{{ elementId }}"><div is-ckoloring="{{ CKolorFactory.ckoloring }}" ng-click="toggleCKoloring()"><input ng-if="type && model" type="{{ type }}" name="{{ name }}" id="{{ inputId }}" ng-model="model"> <span ng-style="{\'background-color\':model}" class="c-ckolor__swatch c-ckolor__picker"></span></div></div>',link:function(t,n){function a(){!0!==t.blur&&void 0!==t.blur||c.removeClass("c-ckolor__overlay-blur"),c.removeClass("c-ckolor__modal")}function s(){h&&h.offsetWidth?l.circleWidth=h.offsetWidth:e(function(){s()},200)}var i=o[0].body,c=angular.element(i),h=i.querySelector(".c-ckolor__wheel"),u=function(){for(var o="",l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<35;r++)o+=l.charAt(Math.floor(Math.random()*l.length));return o}();t.CKolorFactory=l,t.type||(t.type="hidden"),t.toggleCKoloring=function(){if(!i.querySelector("a-ckolor-wheel")){var o=r("<a-ckolor-wheel></a-ckolor-wheel>")(t);c.append(o),h=i.querySelector(".c-ckolor__wheel")}!0!==t.blur&&void 0!==t.blur||c.addClass("c-ckolor__overlay-blur"),c.addClass("c-ckolor__modal"),l.init({model:t.model,modelId:u,defaultColor:t.defaultColor}),l.ckoloring=!0,s()},t.$watch(function(){return l.model},function(o,r){if(o!==r&&l.modelId===u&&o!==t.model){a();var e,n,s;switch(l.originalFormat){case"hex":(e=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(l.model))&&(t.model=l.model);break;case"rgb":try{for(n=l.model.split("(")[1].split(")")[0].split(","),e=!0,s=0;s<n.length;s++)n[s]=parseInt(n[s]),(isNaN(n[s])||n[s]>255||n[s]<0)&&(e=!1);e&&(t.model=l.model)}catch(o){}break;case"hsl":try{for(n=l.model.split("(")[1].split(")")[0].split(","),e=!0,s=0;s<n.length;s++)n[s]=parseInt(n[s]),0===s?(isNaN(n[s])||n[s]>360||n[s]<0)&&(e=!1):(isNaN(n[s])||n[s]>100||n[s]<0)&&(e=!1);e&&(t.model=l.model)}catch(o){}}t.onChange&&t.onChange(t.model)}}),t.$watch(function(){return l.ckoloring},function(o,r){!1===l.ckoloring&&l.modelId===u&&(a(),h&&(i.querySelector("a-ckolor-wheel").remove(),h=null))})}}}]),angular.module("aCKolor").directive("aCkolorWheel",["$timeout","$document","CKolorFactory","$window",function(o,l,r,e){return{restrict:"E",template:'<div class="c-ckolor__overlay" ng-show="CKolorFactory.ckoloring"><div class="c-ckolor__overlay-inner-outer"><div class="c-ckolor__overlay-inner"><div class="c-ckolor__wheel"><div class="c-ckolor__wheel-colors"><div ng-repeat="hue in CKolorFactory.hues track by $index" class="c-ckolor__wheel-color"><div class="c-ckolor__wheel-color-inner1"><div class="c-ckolor__wheel-color-inner2" ng-style="{\'background-color\':\'hsl(\' + hue + \',\' + CKolorFactory.hsl.s + \'%,50%)\'}"></div></div></div></div><div class="c-ckolor__wheel-value" ng-touchmove="CKolorFactory.save()" ng-touch="CKolorFactory.save()"><span class="c-ckolor__wheel-scoop" ng-style="{left: CKolorFactory.radialXY().x + \'px\', top: CKolorFactory.radialXY().y + \'px\', background: \'hsl(\' + CKolorFactory.hsl.h + \',\' + CKolorFactory.hsl.s + \'%,\' + CKolorFactory.hsl.l + \'%)\'}"></span></div></div><div class="c-ckolor__input-row"><div class="c-ckolor__saturation" ng-style="{background: \'linear-gradient(to right, hsl(\' + CKolorFactory.hsl.h + \',0%,\' + CKolorFactory.hsl.l + \'%), hsl(\' + CKolorFactory.hsl.h + \',100%,\' + CKolorFactory.hsl.l + \'%) 100%)\'}"><div class="c-ckolor__saturation-handle" style="left: {{CKolorFactory.hsl.s}}%"></div></div></div><div class="c-ckolor__swatch"><span ng-style="{background: \'hsla(\' + CKolorFactory.hsl.h + \',\' + CKolorFactory.hsl.s + \'%,\' + CKolorFactory.hsl.l + \'%,\' + CKolorFactory.alpha / 100 + \')\'}"></span></div><div class="c-ckolor__input-wrapper button"><button class="c-ckolor__close-btn" ng-click="CKolorFactory.toggleCKoloring()">&#x2716;</button></div></div><div class="c-ckolor_previous-color-container" ng-if="CKolorFactory.previousColors.length"><div ng-repeat="previous in CKolorFactory.previousColors track by $index" class="c-ckolor_previous-swatch" ng-style="{background:previous}" ng-click="CKolorFactory.previousColorClick(previous)"></div></div></div></div>',link:function(e,t){e.CKolorFactory=r;var n=l[0].body,a=t[0].querySelector(".c-ckolor__wheel-value"),s=(t[0].querySelector(".c-ckolor__wheel-scoop"),t[0].querySelector(".c-ckolor__close-btn"),t[0].querySelector(".c-ckolor__save-btn"),t[0].querySelector(".c-ckolor__saturation")),i=(t[0].querySelector(".c-ckolor__saturation-handle"),t[0].querySelector(".c-ckolor__alpha"),t[0].querySelector(".c-ckolor__alpha-handle"),t[0].querySelector(".c-ckolor__overlay-inner"),null),c=null,h=function(l){a||(a=t[0].querySelector(".c-ckolor__wheel-value")),a&&o(function(){r.hueLightFromRadial(l,a)})};e.updateHueLightFromRadial=function(o){h(o)};var u=function(l){var e=(l.changedTouches?l.changedTouches[0].clientX:l.pageX)-c.left,t=Math.round(e/c.width*100);t<0?t=0:t>100&&(t=100),r.hsl.s=t,o(function(){r.updateHSL()})},d=function(o){n.removeEventListener("mousemove",h,!0),n.removeEventListener("touchmove",h,!0),n.removeEventListener("mousemove",u,!0),n.removeEventListener("touchmove",u,!0)},g=function(o){i=a.getBoundingClientRect(),h(o),n.addEventListener("mousemove",h,!0),a.addEventListener("touchmove",h,!1)},v=function(o){c=s.getBoundingClientRect(),u(o),n.addEventListener("mousemove",u,!0),s.addEventListener("touchmove",u,!1)};a.addEventListener("mousedown",g,!0),a.addEventListener("touchstart",g,!0),s.addEventListener("mousedown",v,!0),s.addEventListener("touchstart",v,!1),n.addEventListener("mouseup",d,!0),n.addEventListener("touchend",d,!1),e.$watchCollection(function(){return r.hls},function(o,l){o!==l&&!isNaN(o.h)&&!isNaN(o.l)&&!isNaN(o.s)&&o.h>=0&&o.h<=360&&o.l>=0&&o.l<=255&&o.s>=0&&o.s<=255&&r.updateHSL()})}}}]);
//# sourceMappingURL=aCKolor.min.js.map
