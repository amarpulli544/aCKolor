angular.module("aCKolor",[]).factory("CKolorFactory",function(){var o={alpha:100,ckoloring:!1,defaultColor:"#FFFFFF",display:"hex",inputHsl:{h:null,s:null,l:null},hex:null,hsl:{h:null,s:null,l:null},hues:[75,85,95,105,115,125,135,145,155,165,175,185,195,205,215,225,235,245,255,265,275,285,295,305,315,325,335,345,355,5,15,25,35,45,55,65],model:null,modelId:null,originalFormat:null,previousColors:[],rgb:{r:null,g:null,b:null},circleWidth:0,init:function(l){o.alpha=100,o.defaultColor=l.defaultColor?o.validHex(l.defaultColor):"#FFFFFF",o.model=l.model,o.modelId=l.modelId;var e=angular.fromJson(localStorage.aCKolorPreviousColors);e&&(o.previousColors=e);var r=o.convertTo();r&&(o.hsl.h=o.inputHsl.h=r.h,o.hsl.s=o.inputHsl.s=r.s,o.hsl.l=o.inputHsl.l=r.l,o.rgb=o.hslToRgb(r),o.hex=o.rgbToHex(o.rgb),o.display=o.originalFormat)},save:function(){if(100===o.alpha)switch(o.originalFormat){case"hex":o.model=o.hex;break;case"hsl":o.model="hsl("+o.hsl.h+","+o.hsl.s+"%,"+o.hsl.l+"%)";break;case"rgb":o.model="rgb("+o.rgb.r+","+o.rgb.g+","+o.rgb.b+")"}else"hsl"===o.originalFormat?o.model="hsla("+o.hsl.h+","+o.hsl.s+"%,"+o.hsl.l+"%,"+o.alpha/100+")":o.model="rgba("+o.rgb.r+","+o.rgb.g+","+o.rgb.b+","+o.alpha/100+")";-1===o.previousColors.indexOf(o.model)&&(o.previousColors.unshift(o.model),o.previousColors.length>20&&(o.previousColors.length=20),localStorage.aCKolorPreviousColors=angular.toJson(o.previousColors))},previousColorClick:function(l){o.originalFormat;var e=o.convertTo(l);e&&(o.hsl.h=o.inputHsl.h=e.h,o.hsl.s=o.inputHsl.s=e.s,o.hsl.l=o.inputHsl.l=e.l,o.rgb=o.hslToRgb(e),o.hex=o.rgbToHex(o.rgb),o.display=o.originalFormat),o.updateHSL()},toggleCKoloring:function(){o.ckoloring=!1},updateColorDisplay:function(l){return o.display=l,o.display},updateHSL:function(){o.hex=o.rgbToHex(o.hslToRgb(o.hsl)),o.rgb=o.hslToRgb(o.hsl),o.inputHsl=o.hsl},updateRGB:function(){o.hex=o.rgbToHex(o.rgb),o.hsl=o.rgbToHsl(o.rgb)},updateHEX:function(){o.hex=o.validHex(o.hex);var l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(o.hex);o.hex&&7===o.hex.length&&l&&(o.rgb=o.hexToRgb(o.hex),o.hsl=o.rgbToHsl(o.rgb))},validHex:function(o){var l=o.split("");return"#"===l[0]&&l.shift(),3===l.length&&(l=l.concat(l)),o="#"+l.join("")},hueLightFromRadial:function(l,e){var r,t;l.changedTouches?(r=l.changedTouches[0].clientX,t=l.changedTouches[0].clientY):(r=l.pageX,t=l.pageY);var n=e.getBoundingClientRect(),a=n.width/2,i=r-(a+n.left),s=t-(a+n.top),c=Math.atan2(s,i)*(180/Math.PI);c<0&&(c+=360);var h=Math.abs(i),u=Math.abs(s),d=Math.round(100-100*Math.sqrt(h*h+u*u)/a);return o.hsl.l=d>-1?d<101?d:100:0,o.hsl.h=Math.round(c)>-1||Math.round(c)<360?Math.round(c):0,o.updateHSL(),o.radialXY(),{h:o.hsl.h,l:o.hsl.l}},radialXY:function(){var l=o.circleWidth/2,e=l*((100-o.hsl.l)/100),r=o.hsl.h;return{x:l+e*Math.cos(r*Math.PI/180),y:2*l-(l+-e*Math.sin(r*Math.PI/180))}},convertTo:function(l){var e;return(l=l||(o.model?o.model:"null")).indexOf("#")>-1?(l=o.validHex(l),e=o.hexToRgb(l),o.originalFormat="hex",o.rgbToHsl(e)):l.indexOf("hsla")>-1?(l=l.split("(")[1],l=l.substring(0,l.length-1),l=l.split(","),o.originalFormat="hsl",o.alpha=100*l[3],{h:parseInt(l[0]),s:parseInt(l[1]),l:parseInt(l[2])}):l.indexOf("hsl")>-1?(l=l.split("(")[1],l=l.substring(0,l.length-1),l=l.split(","),o.originalFormat="hsl",{h:parseInt(l[0]),s:parseInt(l[1]),l:parseInt(l[2])}):l.indexOf("rgba")>-1?(l=l.split("(")[1],l=l.substring(0,l.length-1),l=l.split(","),o.originalFormat="rgb",o.alpha=100*l[3],o.rgbToHsl({r:parseInt(l[0]),g:parseInt(l[1]),b:parseInt(l[2])})):l.indexOf("rgb")>-1?(l=l.split("(")[1],l=l.substring(0,l.length-1),l=l.split(","),o.originalFormat="rgb",o.rgbToHsl({r:parseInt(l[0]),g:parseInt(l[1]),b:parseInt(l[2])})):l.indexOf("transparent")>-1?(o.originalFormat="rgb",o.alpha=0,e=o.hexToRgb(o.defaultColor),o.rgbToHsl(e)):(o.originalFormat="rgb",e=o.hexToRgb(o.defaultColor),o.rgbToHsl(e))},hexToRgb:function(o){var l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(o);return l?{r:parseInt(l[1],16),g:parseInt(l[2],16),b:parseInt(l[3],16)}:null},rgbToHsl:function(l){var e,r,t=l.r/255,n=l.g/255,a=l.b/255,i=Math.max(t,n,a),s=Math.min(t,n,a),c=(i+s)/2;if(i==s)e=r=0;else{var h=i-s;switch(r=c>.5?h/(2-i-s):h/(i+s),i){case t:e=(n-a)/h+(n<a?6:0);break;case n:e=(a-t)/h+2;break;case a:e=(t-n)/h+4}e/=6}return(0===e||isNaN(e))&&(e=o.hsl.h),{h:Math.round(360*e*100)/100,s:Math.round(100*r*100)/100,l:Math.round(100*c*100)/100}},hslToRgb:function(o){var l,e,r,t,n,a,i=o.h,s=o.s,c=o.l;return isFinite(i)||(i=0),isFinite(s)||(s=0),isFinite(c)||(c=0),(i/=60)<0&&(i=6- -i%6),i%=6,s=Math.max(0,Math.min(1,s/100)),c=Math.max(0,Math.min(1,c/100)),n=(1-Math.abs(2*c-1))*s,a=n*(1-Math.abs(i%2-1)),i<1?(l=n,e=a,r=0):i<2?(l=a,e=n,r=0):i<3?(l=0,e=n,r=a):i<4?(l=0,e=a,r=n):i<5?(l=a,e=0,r=n):(l=n,e=0,r=a),t=c-n/2,l=Math.round(255*(l+t)),e=Math.round(255*(e+t)),r=Math.round(255*(r+t)),{r:l,g:e,b:r}},intToHex:function(o){var l=parseInt(o).toString(16);return l.length<2?"0"+l:l},rgbToHex:function(l){return"#"+o.intToHex(l.r)+o.intToHex(l.g)+o.intToHex(l.b)}};return o}),function(o){"use strict";o.directive("aCkolorHexInput",function(){return{restrict:"A",require:"ngModel",link:function(o,l,e,r){r.$parsers.push(function(o){var l=o.split("");return"#"===l[0]&&l.shift(),3===l.length&&(l=l.concat(l)),o="#"+l.join("")})}}})}(angular.module("aCKolor")),angular.module("aCKolor").directive("aCkolor",["$document","CKolorFactory","$compile","$timeout",function(o,l,e,r){return{restrict:"E",scope:{onChange:"=?",elementId:"=",inputId:"=",model:"=",name:"=",type:"=",defaultColor:"=",blur:"="},template:'<div class="c-ckolor__wrapper" id="{{ elementId }}"><div is-ckoloring="{{ CKolorFactory.ckoloring }}" ng-click="toggleCKoloring()"><input ng-if="type && model" type="{{ type }}" name="{{ name }}" id="{{ inputId }}" ng-model="model"> <span ng-style="{\'background-color\':model}" class="c-ckolor__swatch c-ckolor__picker"></span></div></div>',link:function(t,n){function a(){!0!==t.blur&&void 0!==t.blur||c.removeClass("c-ckolor__overlay-blur"),c.removeClass("c-ckolor__modal")}function i(){h&&h.offsetWidth?l.circleWidth=h.offsetWidth:r(function(){i()},200)}var s=o[0].body,c=angular.element(s),h=s.querySelector(".c-ckolor__wheel"),u=function(){for(var o="",l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=0;e<35;e++)o+=l.charAt(Math.floor(Math.random()*l.length));return o}();t.CKolorFactory=l,t.type||(t.type="hidden"),t.toggleCKoloring=function(){if(!s.querySelector("a-ckolor-wheel")){var o=e("<a-ckolor-wheel></a-ckolor-wheel>")(t);c.append(o),h=s.querySelector(".c-ckolor__wheel")}!0!==t.blur&&void 0!==t.blur||c.addClass("c-ckolor__overlay-blur"),c.addClass("c-ckolor__modal"),l.init({model:t.model,modelId:u,defaultColor:t.defaultColor}),l.ckoloring=!0,i()},t.$watch(function(){return l.model},function(o,e){if(o!==e&&l.modelId===u&&o!==t.model){a();var r,n,i;switch(l.originalFormat){case"hex":(r=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(l.model))&&(t.model=l.model);break;case"rgb":try{for(n=l.model.split("(")[1].split(")")[0].split(","),r=!0,i=0;i<n.length;i++)n[i]=parseInt(n[i]),(isNaN(n[i])||n[i]>255||n[i]<0)&&(r=!1);r&&(t.model=l.model)}catch(o){}break;case"hsl":try{for(n=l.model.split("(")[1].split(")")[0].split(","),r=!0,i=0;i<n.length;i++)n[i]=parseInt(n[i]),0===i?(isNaN(n[i])||n[i]>360||n[i]<0)&&(r=!1):(isNaN(n[i])||n[i]>100||n[i]<0)&&(r=!1);r&&(t.model=l.model)}catch(o){}}t.onChange&&t.onChange(t.model)}}),t.$watch(function(){return l.ckoloring},function(o,e){!1===l.ckoloring&&l.modelId===u&&(a(),h&&(s.querySelector("a-ckolor-wheel").remove(),h=null))})}}}]),angular.module("aCKolor").directive("aCkolorWheel",["$timeout","$document","CKolorFactory","$window",function(o,l,e,r){return{restrict:"E",template:'<div class="c-ckolor__overlay" ng-show="CKolorFactory.ckoloring"><div class="c-ckolor__overlay-inner-outer"><div class="c-ckolor__overlay-inner"><div class="c-ckolor__wheel"><div class="c-ckolor__wheel-colors"><div ng-repeat="hue in CKolorFactory.hues track by $index" class="c-ckolor__wheel-color"><div class="c-ckolor__wheel-color-inner1"><div class="c-ckolor__wheel-color-inner2" ng-style="{\'background-color\':\'hsl(\' + hue + \',\' + CKolorFactory.hsl.s + \'%,50%)\'}"></div></div></div></div><div class="c-ckolor__wheel-value" ng-click="CKolorFactory.save()"><span class="c-ckolor__wheel-scoop" ng-style="{left: CKolorFactory.radialXY().x + \'px\', top: CKolorFactory.radialXY().y + \'px\', background: \'hsl(\' + CKolorFactory.hsl.h + \',\' + CKolorFactory.hsl.s + \'%,\' + CKolorFactory.hsl.l + \'%)\'}"></span></div></div><div class="c-ckolor__input-row"><div class="c-ckolor__saturation" ng-style="{background: \'linear-gradient(to right, hsl(\' + CKolorFactory.hsl.h + \',0%,\' + CKolorFactory.hsl.l + \'%), hsl(\' + CKolorFactory.hsl.h + \',100%,\' + CKolorFactory.hsl.l + \'%) 100%)\'}"><div class="c-ckolor__saturation-handle" style="left: {{CKolorFactory.hsl.s}}%"></div></div></div><div class="c-ckolor__input-wrapper button"><button type="submit" class="btn btn-default" ng-click="CKolorFactory.toggleCKoloring()">Back</button></div></div></div></div>',link:function(r,t){r.CKolorFactory=e;var n=l[0].body,a=t[0].querySelector(".c-ckolor__wheel-value"),i=(t[0].querySelector(".c-ckolor__wheel-scoop"),t[0].querySelector(".c-ckolor__close-btn"),t[0].querySelector(".c-ckolor__save-btn"),t[0].querySelector(".c-ckolor__saturation")),s=(t[0].querySelector(".c-ckolor__saturation-handle"),t[0].querySelector(".c-ckolor__alpha"),t[0].querySelector(".c-ckolor__alpha-handle"),t[0].querySelector(".c-ckolor__overlay-inner"),null),c=null,h=function(l){a||(a=t[0].querySelector(".c-ckolor__wheel-value")),a&&o(function(){e.hueLightFromRadial(l,a)})};r.updateHueLightFromRadial=function(o){h(o)};var u=function(l){var r=(l.changedTouches?l.changedTouches[0].clientX:l.pageX)-c.left,t=Math.round(r/c.width*100);t<0?t=0:t>100&&(t=100),e.hsl.s=t,o(function(){e.updateHSL()})},d=function(o){n.removeEventListener("mousemove",h,!0),n.removeEventListener("touchmove",h,!0),n.removeEventListener("mousemove",u,!0),n.removeEventListener("touchmove",u,!0)},g=function(o){s=a.getBoundingClientRect(),h(o),n.addEventListener("mousemove",h,!0),a.addEventListener("touchmove",h,!1)},p=function(o){c=i.getBoundingClientRect(),u(o),n.addEventListener("mousemove",u,!0),i.addEventListener("touchmove",u,!1)};a.addEventListener("mousedown",g,!0),a.addEventListener("touchstart",g,!0),i.addEventListener("mousedown",p,!0),i.addEventListener("touchstart",p,!1),n.addEventListener("mouseup",d,!0),n.addEventListener("touchend",d,!1),r.$watchCollection(function(){return e.hls},function(o,l){o!==l&&!isNaN(o.h)&&!isNaN(o.l)&&!isNaN(o.s)&&o.h>=0&&o.h<=360&&o.l>=0&&o.l<=255&&o.s>=0&&o.s<=255&&e.updateHSL()})}}}]);
//# sourceMappingURL=aCKolor.min.js.map
